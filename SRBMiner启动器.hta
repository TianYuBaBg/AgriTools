<!DOCTYPE html>
<html>
<head>
<title>SRBMiner å›¾å½¢åŒ–å¯åŠ¨å™¨ - ç‹¬ç«‹æ—¥å¿—é¢æ¿</title>
<HTA:APPLICATION 
    ID="SRBMinerLauncher"
    APPLICATIONNAME="SRBMiner Launcher"
    BORDER="thin"
    BORDERSTYLE="normal"
    CAPTION="yes"
    ICON=""
    MAXIMIZEBUTTON="yes"
    MINIMIZEBUTTON="yes"
    SHOWINTASKBAR="yes"
    SINGLEINSTANCE="no"
    SYSMENU="yes"
    VERSION="1.0"
    WINDOWSTATE="normal"
    SCROLL="yes">
<meta charset="utf-8">
<style>
    body {
        font-family: Microsoft YaHei, Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f5f5f5;
        overflow: hidden;
    }
    .container {
        display: flex;
        flex-direction: column;
        height: 100vh;
    }
    .main-content {
        display: flex;
        flex: 1;
        overflow: hidden;
    }
    .config-panel {
        width: 400px;
        background: white;
        padding: 20px;
        border-right: 1px solid #ddd;
        overflow-y: auto;
    }
    .log-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        background: #1e1e1e;
    }
    .log-header {
        padding: 10px;
        background: #2d2d2d;
        border-bottom: 1px solid #444;
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: #fff;
    }
    .log-content {
        flex: 1;
        color: #00ff00;
        padding: 10px;
        font-family: Consolas, Monaco, 'Courier New', monospace;
        font-size: 12px;
        overflow-y: auto;
    }
    .log-toggle {
        background: #444;
        color: white;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        border-radius: 3px;
    }
    h2 {
        color: #333;
        margin-top: 0;
    }
    .form-group {
        margin-bottom: 15px;
    }
    label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
    }
    input[type="text"], select {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
    }
    .checkbox-group {
        margin: 10px 0;
    }
    .checkbox-group label {
        display: inline-block;
        margin-right: 15px;
        font-weight: normal;
    }
    .button-group {
        margin-top: 20px;
        text-align: center;
    }
    button {
        padding: 10px 20px;
        margin: 0 5px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
    }
    #startBtn {
        background-color: #4CAF50;
        color: white;
    }
    #stopBtn {
        background-color: #f44336;
        color: white;
    }
    #exitBtn {
        background-color: #9e9e9e;
        color: white;
    }
    #clearLogBtn {
        background-color: #ff9800;
        color: white;
        padding: 5px 10px;
        font-size: 12px;
    }
    #toggleLogBtn {
        background-color: #666;
        color: white;
        padding: 5px 10px;
        font-size: 12px;
        margin-right: 10px;
    }
    .status {
        margin-top: 15px;
        padding: 10px;
        background-color: #e7f3fe;
        border-left: 4px solid #2196F3;
    }
    .window-control {
        background-color: #e3f2fd;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
        border-left: 4px solid #2196f3;
    }
    .error {
        color: #ff4444;
        background-color: #ffeeee;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
        border-left: 4px solid #ff4444;
    }
    .success {
        color: #4CAF50;
        background-color: #eeffee;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
        border-left: 4px solid #4CAF50;
    }
    .mining-stats {
        background-color: #fff3cd;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
        border-left: 4px solid #ffc107;
    }
    .log-controls {
        display: flex;
        align-items: center;
    }
</style>
</head>
<body>
    <div class="container">
        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <!-- å·¦ä¾§é…ç½®é¢æ¿ -->
            <div class="config-panel">
                <h2>ğŸš€ SRBMiner é…ç½®</h2>
                <h2>QQäº¤æµç¾¤419240297</h2>
                <div class="form-group">
                    <label for="algorithm">ç®—æ³•ï¼š</label>
                    <select id="algorithm">
                        <option value="randomscash" selected>randomscash</option>
                        <option value="verushash">verushash</option>
                        <option value="autolykos2">autolykos2</option>
                        <option value="ethash">ethash</option>
                        <option value="kawpow">kawpow</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="pool">çŸ¿æ± åœ°å€ï¼š</label>
                    <input type="text" id="pool" value="eu.rplant.xyz:17019">
                </div>

                <div class="form-group">
                    <label for="wallet">é’±åŒ…åœ°å€ï¼š</label>
                    <input type="text" id="wallet" value="scash1qu0ac67h9rpa4a872fkl90ujw978jdz6wc6ymx2">
                </div>

                <div class="form-group">
                    <label for="worker">çŸ¿å·¥å·ï¼š</label>
                    <input type="text" id="worker" value="005">
                </div>

                <div class="form-group">
                    <label for="proxy">SOCKS5 ä»£ç†ï¼š</label>
                    <input type="text" id="proxy" value="127.0.0.1:10808">
                </div>

                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="tls" checked> å¯ç”¨ TLS åŠ å¯†
                    </label>
                    <label>
                        <input type="checkbox" id="keepalive" checked> ä¿æŒè¿æ¥
                    </label>
                </div>

                <div class="window-control">
                    <label style="font-weight: bold; display: block; margin-bottom: 8px;">å‘½ä»¤è¡Œçª—å£æ§åˆ¶ï¼š</label>
                    <div class="checkbox-group">
                        <label>
                            <input type="radio" name="windowMode" id="showWindow" value="show"> æ˜¾ç¤ºå‘½ä»¤è¡Œçª—å£
                        </label>
                        <label>
                            <input type="radio" name="windowMode" id="hideWindow" value="hide" checked> éšè—å‘½ä»¤è¡Œçª—å£
                        </label>
                    </div>
                </div>

                <div class="button-group">
                    <button id="startBtn" onclick="startMining()">å¼€å§‹æŒ–çŸ¿</button>
                    <button id="stopBtn" onclick="stopMining()" disabled>åœæ­¢æŒ–çŸ¿</button>
                    <button id="exitBtn" onclick="window.close()">é€€å‡ºç¨‹åº</button>
                </div>

                <div class="status" id="status">å°±ç»ª</div>
                <div id="miningStats" class="mining-stats" style="display: none;">
                    <strong>æŒ–çŸ¿çŠ¶æ€:</strong> <span id="miningStatus">è¿è¡Œä¸­</span><br>
                    <strong>æ¥å—ä»½é¢:</strong> <span id="acceptedShares">0</span><br>
                    <strong>æœ€åæ›´æ–°:</strong> <span id="lastUpdate">-</span>
                </div>
                <div id="errorMessage" class="error" style="display: none;"></div>
                <div id="successMessage" class="success" style="display: none;"></div>
            </div>

            <!-- å³ä¾§æ—¥å¿—å®¹å™¨ -->
            <div class="log-container">
                <div class="log-header">
                    <h3>ğŸ“‹ å®æ—¶æ—¥å¿—</h3>
                    <div class="log-controls">
                        <button id="toggleLogBtn" onclick="toggleLog()">éšè—æ—¥å¿—</button>
                        <button id="clearLogBtn" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
                    </div>
                </div>
                <div id="logContent" class="log-content">ç­‰å¾…å¯åŠ¨çŸ¿å·¥...</div>
            </div>
        </div>
    </div>

    <script language="JavaScript">
        var minerProcess, logMonitor, statsMonitor;
        var logFile = "srbminer_log.txt";
        var batFile = "start_miner.bat";
        var acceptedShares = 0;
        var startTime = null;
        var isLogVisible = true;

        // åˆå§‹åŒ–
        window.onload = function() {
            window.resizeTo(800, 1200);
            document.getElementById("hideWindow").checked = true;
        };

        // åˆ‡æ¢æ—¥å¿—æ˜¾ç¤º
        function toggleLog() {
            var logContent = document.getElementById("logContent");
            var toggleBtn = document.getElementById("toggleLogBtn");
            
            if (isLogVisible) {
                logContent.style.display = "none";
                toggleBtn.textContent = "æ˜¾ç¤ºæ—¥å¿—";
                isLogVisible = false;
            } else {
                logContent.style.display = "block";
                toggleBtn.textContent = "éšè—æ—¥å¿—";
                isLogVisible = true;
            }
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            document.getElementById("errorMessage").style.display = "block";
            document.getElementById("errorMessage").innerHTML = message;
            document.getElementById("successMessage").style.display = "none";
            addLog("é”™è¯¯: " + message);
        }

        // æ˜¾ç¤ºæˆåŠŸä¿¡æ¯
        function showSuccess(message) {
            document.getElementById("successMessage").style.display = "block";
            document.getElementById("successMessage").innerHTML = message;
            document.getElementById("errorMessage").style.display = "none";
            addLog("æˆåŠŸ: " + message);
        }

        // æ›´æ–°æŒ–çŸ¿ç»Ÿè®¡
        function updateMiningStats() {
            document.getElementById("miningStats").style.display = "block";
            document.getElementById("acceptedShares").innerText = acceptedShares;
            document.getElementById("lastUpdate").innerText = new Date().toLocaleTimeString();
        }

        // æ¸…ç©ºä¿¡æ¯
        function clearMessages() {
            document.getElementById("errorMessage").style.display = "none";
            document.getElementById("successMessage").style.display = "none";
        }

        // æ¸…ç©ºæ—¥å¿—
        function clearLog() {
            document.getElementById("logContent").innerHTML = "";
            acceptedShares = 0;
            updateMiningStats();
        }

        // æ·»åŠ æ—¥å¿—åˆ°ç•Œé¢
        function addLog(message) {
            var logDiv = document.getElementById("logContent");
            logDiv.innerHTML = logDiv.innerHTML + message + "<br>";
            logDiv.scrollTop = logDiv.scrollHeight;
            
            // æ£€æµ‹æ¥å—ä»½é¢
            if (message.indexOf("share accepted") > -1) {
                acceptedShares++;
                updateMiningStats();
            }
        }

        // æ£€æŸ¥çŸ¿å·¥æ˜¯å¦åœ¨è¿è¡Œ
        function isMinerRunning() {
            try {
                var ws = new ActiveXObject("WScript.Shell");
                var processes = ws.Exec('tasklist /fi "imagename eq srbminer-multi.exe" /nh');
                var output = processes.StdOut.ReadAll();
                return output.indexOf("srbminer-multi.exe") > -1;
            } catch (e) {
                return false;
            }
        }

        // æ£€æŸ¥æ—¥å¿—ä¸­æ˜¯å¦æœ‰æˆåŠŸè¿æ¥çš„ä¿¡æ¯
        function checkLogForSuccess() {
            try {
                var fso = new ActiveXObject("Scripting.FileSystemObject");
                if (fso.FileExists(logFile)) {
                    var logStream = fso.OpenTextFile(logFile, 1);
                    var content = logStream.ReadAll();
                    logStream.Close();
                    
                    // å¦‚æœæ—¥å¿—ä¸­åŒ…å«è¿™äº›æˆåŠŸä¿¡æ¯ï¼Œå°±è®¤ä¸ºçŸ¿å·¥å¯åŠ¨æˆåŠŸ
                    var successIndicators = [
                        "Connected to",
                        "connection established",
                        "share accepted",
                        "Job received",
                        "Difficulty"
                    ];
                    
                    for (var i = 0; i < successIndicators.length; i++) {
                        if (content.indexOf(successIndicators[i]) > -1) {
                            return true;
                        }
                    }
                }
                return false;
            } catch (e) {
                return false;
            }
        }

        // å¯åŠ¨æŒ–çŸ¿
        function startMining() {
            try {
                clearMessages();
                document.getElementById("miningStats").style.display = "none";
                acceptedShares = 0;
                startTime = new Date();
                
                // æ£€æŸ¥çŸ¿å·¥æ˜¯å¦å·²åœ¨è¿è¡Œ
                if (isMinerRunning()) {
                    showError("çŸ¿å·¥å·²ç»åœ¨è¿è¡Œä¸­ï¼");
                    return;
                }
                
                // è·å–é…ç½®å‚æ•°
                var algorithm = document.getElementById("algorithm").value;
                var pool = document.getElementById("pool").value;
                var wallet = document.getElementById("wallet").value;
                var worker = document.getElementById("worker").value;
                var proxy = document.getElementById("proxy").value;
                var useTls = document.getElementById("tls").checked;
                var useKeepalive = document.getElementById("keepalive").checked;
                var showWindow = document.getElementById("showWindow").checked;
                
                // éªŒè¯å¿…è¦å‚æ•°
                if (!pool) {
                    showError("çŸ¿æ± åœ°å€ä¸èƒ½ä¸ºç©ºï¼");
                    return;
                }
                
                if (!wallet) {
                    showError("é’±åŒ…åœ°å€ä¸èƒ½ä¸ºç©ºï¼");
                    return;
                }
                
                // æ„å»ºå®Œæ•´é’±åŒ…åœ°å€
                var fullWallet = worker ? wallet + "." + worker : wallet;
                
                // æ„å»ºæ­£ç¡®çš„å‘½ä»¤è¡Œå‚æ•°
                var args = "--algorithm " + algorithm;
                args += " --pool " + pool;
                args += " --wallet " + fullWallet;
                
                if (proxy) {
                    args += " --proxy " + proxy;
                }
                
                if (useTls) {
                    args += " --tls true";
                }
                
                if (useKeepalive) {
                    args += " --keepalive true";
                }
                
                // æ·»åŠ æ—¥å¿—æ–‡ä»¶å‚æ•°
                args += " --log-file " + logFile + " --log-file-mode 0";
                
                // æ›´æ–°çŠ¶æ€
                document.getElementById("status").innerHTML = "æ­£åœ¨å¯åŠ¨çŸ¿å·¥...";
                addLog("æ­£åœ¨å¯åŠ¨çŸ¿å·¥...");
                addLog("å®Œæ•´å‘½ä»¤: srbminer-multi.exe " + args);
                
                // åˆ›å»ºæ‰¹å¤„ç†æ–‡ä»¶
                var fso = new ActiveXObject("Scripting.FileSystemObject");
                var batStream = fso.CreateTextFile(batFile, true);
                batStream.WriteLine("@echo off");
                batStream.WriteLine("echo æ­£åœ¨å¯åŠ¨ SRBMiner...");
                batStream.WriteLine("srbminer-multi.exe " + args);
                batStream.WriteLine("if %errorlevel% neq 0 (");
                batStream.WriteLine("   echo é”™è¯¯: ç¨‹åºé€€å‡ºä»£ç  %errorlevel%");
                batStream.WriteLine("   pause");
                batStream.WriteLine(")");
                batStream.Close();
                
                // å¯åŠ¨çŸ¿å·¥
                var ws = new ActiveXObject("WScript.Shell");
                if (showWindow) {
                    ws.Run('cmd /k "' + batFile + '"', 1, false);
                } else {
                    ws.Run('cmd /c "' + batFile + '"', 0, false);
                }
                
                // æ”¹è¿›çš„å¯åŠ¨æ£€æµ‹ï¼šæ£€æŸ¥æ—¥å¿—ä¸­çš„æˆåŠŸä¿¡æ¯
                var checkCount = 0;
                var maxChecks = 10;
                
                var checkInterval = setInterval(function() {
                    checkCount++;
                    
                    if (checkLogForSuccess()) {
                        clearInterval(checkInterval);
                        document.getElementById("status").innerHTML = "çŸ¿å·¥å·²å¯åŠ¨";
                        document.getElementById("startBtn").disabled = true;
                        document.getElementById("stopBtn").disabled = false;
                        showSuccess("çŸ¿å·¥å¯åŠ¨æˆåŠŸï¼");
                        addLog("æ£€æµ‹åˆ°æˆåŠŸè¿æ¥çŸ¿æ± ï¼ŒçŸ¿å·¥æ­£åœ¨è¿è¡Œ");
                        updateMiningStats();
                        
                        // å¼€å§‹ç›‘æ§æ—¥å¿—æ–‡ä»¶
                        logMonitor = setInterval(checkLog, 2000);
                        statsMonitor = setInterval(updateMiningStats, 5000);
                    } else if (checkCount >= maxChecks) {
                        clearInterval(checkInterval);
                        if (isMinerRunning()) {
                            document.getElementById("status").innerHTML = "çŸ¿å·¥å¯åŠ¨ä¸­...";
                            showSuccess("çŸ¿å·¥è¿›ç¨‹å·²å¯åŠ¨ï¼Œç­‰å¾…è¿æ¥çŸ¿æ± ");
                            document.getElementById("startBtn").disabled = true;
                            document.getElementById("stopBtn").disabled = false;
                            
                            logMonitor = setInterval(checkLog, 2000);
                            statsMonitor = setInterval(updateMiningStats, 5000);
                        } else {
                            showError("çŸ¿å·¥å¯åŠ¨å¤±è´¥ï¼è¯·é€‰æ‹©'æ˜¾ç¤ºå‘½ä»¤è¡Œçª—å£'æŸ¥çœ‹å…·ä½“é”™è¯¯");
                            document.getElementById("startBtn").disabled = false;
                        }
                    }
                }, 2000);
                
            } catch (e) {
                showError("å¯åŠ¨è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: " + e.message);
            }
        }

        // æ£€æŸ¥æ—¥å¿—æ›´æ–°
        function checkLog() {
            try {
                var fso = new ActiveXObject("Scripting.FileSystemObject");
                if (fso.FileExists(logFile)) {
                    var logStream = fso.OpenTextFile(logFile, 1);
                    var content = logStream.ReadAll();
                    logStream.Close();
                    
                    if (content) {
                        var formattedContent = content.replace(/\r\n/g, "<br>");
                        // é«˜äº®é‡è¦ä¿¡æ¯
                        formattedContent = formattedContent.replace(/share accepted/gi, '<span style="color: #00ff00">$&</span>');
                        formattedContent = formattedContent.replace(/error/gi, '<span style="color: #ff4444">$&</span>');
                        formattedContent = formattedContent.replace(/connected/gi, '<span style="color: #87ceeb">$&</span>');
                        
                        document.getElementById("logContent").innerHTML = formattedContent;
                        var logDiv = document.getElementById("logContent");
                        logDiv.scrollTop = logDiv.scrollHeight;
                        
                        // æ›´æ–°æ¥å—ä»½é¢è®¡æ•°
                        var shareCount = (content.match(/share accepted/gi) || []).length;
                        if (shareCount > acceptedShares) {
                            acceptedShares = shareCount;
                            updateMiningStats();
                        }
                    }
                }
            } catch (e) {
                // å¿½ç•¥æ—¥å¿—è¯»å–é”™è¯¯
            }
        }

        // åœæ­¢æŒ–çŸ¿
        function stopMining() {
            try {
                // åœæ­¢ç›‘æ§
                if (logMonitor) clearInterval(logMonitor);
                if (statsMonitor) clearInterval(statsMonitor);
                
                // ç»“æŸçŸ¿å·¥è¿›ç¨‹
                var ws = new ActiveXObject("WScript.Shell");
                ws.Run('taskkill /f /im srbminer-multi.exe', 0, true);
                ws.Run('taskkill /f /im cmd.exe', 0, true);
                
                addLog("çŸ¿å·¥å·²åœæ­¢");
                document.getElementById("status").innerHTML = "çŸ¿å·¥å·²åœæ­¢";
                document.getElementById("startBtn").disabled = false;
                document.getElementById("stopBtn").disabled = true;
                showSuccess("çŸ¿å·¥å·²æˆåŠŸåœæ­¢");
                
                // æ¸…ç†ä¸´æ—¶æ–‡ä»¶
                var fso = new ActiveXObject("Scripting.FileSystemObject");
                if (fso.FileExists(batFile)) {
                    fso.DeleteFile(batFile);
                }
            } catch (e) {
                showError("åœæ­¢çŸ¿å·¥æ—¶å‘ç”Ÿé”™è¯¯: " + e.message);
            }
        }

        // ç¨‹åºå…³é—­æ—¶æ¸…ç†
        window.onbeforeunload = function() {
            stopMining();
        };
    </script>
</body>
</html>